<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JUSKVI OS</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
:root{--bg:#050505;--acc:#00E5FF;--vis:#D946EF;--skep:#F59E0B}
body{margin:0;background:var(--bg);color:#ddd;font-family:monospace;height:100vh;display:flex;flex-direction:column}
#gate{position:fixed;inset:0;background:#000;z-index:9;display:flex;flex-direction:column;align-items:center;justify-content:center}
#gate input{padding:15px;background:#111;border:1px solid #333;color:var(--acc);text-align:center;outline:none;margin-top:20px;width:200px}
header{padding:15px;border-bottom:1px solid #333;display:flex;justify-content:space-between;align-items:center;background:#000}
#chat{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:20px}
.msg{animation:f 0.3s}
.user{align-self:flex-end;background:#222;padding:10px;border-radius:10px;max-width:85%}
@keyframes f{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
details{background:#0a0a0a;border:1px solid #333;border-radius:8px;margin-bottom:10px}
summary{padding:12px;cursor:pointer;font-weight:bold;border-bottom:1px solid #222}
.content{padding:15px;line-height:1.5;color:#ccc}
#ctl{padding:15px;border-top:1px solid #333;display:flex;gap:10px;background:#000}
input[type=text]{flex:1;padding:12px;background:#1a1a1a;border:1px solid #333;color:#fff;border-radius:8px;outline:none}
.btn{background:none;border:1px solid #333;color:#888;padding:10px;border-radius:50%;cursor:pointer}
.btn.on{color:red;border-color:red}
</style>
</head>
<body>
<div id="gate">
<div style="font-size:40px; color:var(--acc)">üí†</div>
<div style="margin-top:20px; letter-spacing:4px; font-weight:bold">JUSKVI</div>
<input type="password" id="pw" placeholder="IDENTITY" onkeyup="if(event.key==='Enter')l()">
<button onclick="l()" style="margin-top:10px;padding:10px 30px;background:var(--acc);border:none;color:#000;font-weight:bold">INITIALIZE</button>
</div>
<header>
    <div style="display:flex;align-items:center;gap:10px">
        <span style="color:var(--acc)">üí†</span>
        <span>JUSKVI <strong>OS</strong></span>
    </div>
    <div style="font-size:10px;color:#666">SYSTEM READY</div>
</header>
<div id="chat"><div style="text-align:center;color:#444;margin-top:20px">AWAITING INPUT</div></div>
<div id="ctl">
<input type="file" id="f" hidden onchange="u(this)"><button class="btn" onclick="document.getElementById('f').click()">üì∑</button>
<button class="btn" id="m" onclick="tm()">üé§</button>
<input type="text" id="t" placeholder="Ask Juskvi..." onkeypress="if(event.key==='Enter')s()">
<button class="btn" onclick="s()" style="border-radius:8px;width:auto;padding:0 20px;color:var(--acc);border-color:var(--acc)">SEND</button>
</div>
<script>
function l(){if(document.getElementById('pw').value==='admin')document.getElementById('gate').remove()}
let im=null,rec=window.webkitSpeechRecognition?new webkitSpeechRecognition():null;
if(rec)rec.onresult=e=>{document.getElementById('t').value=e.results[0][0].transcript;tm();s()}
function tm(){let b=document.getElementById('m');if(b.classList.contains('on')){rec.stop();b.classList.remove('on')}else{rec.start();b.classList.add('on')}}
function u(e){let r=new FileReader();r.onload=ev=>{im=ev.target.result;document.getElementById('chat').innerHTML+='<div class="msg user">üì∑ Image Uploaded</div>'};if(e.files[0])r.readAsDataURL(e.files[0])}
let currUtterance = null;
function toggleSpeak(text, btn) {
    let synth = window.speechSynthesis;
    if (synth.speaking && !synth.paused) {
        synth.pause();
        btn.innerText = "‚ñ∂ RESUME";
    } else if (synth.paused) {
        synth.resume();
        btn.innerText = "‚è∏ PAUSE";
    } else {
        synth.cancel();
        currUtterance = new SpeechSynthesisUtterance(text);
        currUtterance.onend = () => { btn.innerText = "üîä READ"; };
        synth.speak(currUtterance);
        btn.innerText = "‚è∏ PAUSE";
    }
}
async function s(){
let t=document.getElementById('t'),v=t.value.trim();if(!v&&!im)return;
let c=document.getElementById('chat');c.innerHTML+=`<div class="msg user">${v}</div>`;t.value='';
let id='L'+Date.now();c.innerHTML+=`<div id="${id}" style="text-align:center;color:#666;font-size:12px;margin-top:10px">ANALYZING...</div>`;c.scrollTop=c.scrollHeight;
try{let r=await fetch('/api/v6/synthesis',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:v,image:im})});
let d=await r.json();document.getElementById(id).remove();im=null;
let cleanText = d.final_synthesis.replace(/[`"']/g, "");
c.innerHTML+=`
<div class="msg">
    <details><summary style="color:var(--vis)">‚ú® VISIONARY</summary><div class="content">${marked.parse(d.visionary)}</div></details>
    <details><summary style="color:var(--skep)">üõ°Ô∏è SKEPTIC</summary><div class="content">${marked.parse(d.skeptic)}</div></details>
    <div style="background:#0a1a2f;border:1px solid var(--acc);border-radius:8px;padding:15px">
        <div style="display:flex;justify-content:space-between;align-items:center;color:var(--acc);font-weight:bold;font-size:12px;margin-bottom:10px">
            <span>üí† JUSKVI VERDICT</span>
            <button onclick="toggleSpeak(\`${cleanText}\`, this)" style="background:none;border:1px solid var(--acc);color:var(--acc);border-radius:4px;cursor:pointer;padding:5px 10px;font-size:10px">üîä READ</button>
        </div>
        <div style="line-height:1.5">${marked.parse(d.final_synthesis)}</div>
    </div>
</div>`}
catch(e){document.getElementById(id).innerText="Error"}c.scrollTop=c.scrollHeight}
</script></body></html>
